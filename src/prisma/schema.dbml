//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Project "FyTy Core Database" {
  database_type: ''
  Note: ''
}

Table Game {
  id String [pk]
  name String [unique, not null]
  teamCap Int [not null]
  lineupCap Int [not null]
  logoUrl String [not null]
  coverUrl String [not null]
  isActive Boolean [not null, default: true]
  desc String [not null, default: '']
}

Table Room {
  id String [pk]
  name String [not null]
  status RoomStatus [not null, default: 'AVAILABLE']
  option String [not null, default: '']
  startAt DateTime [not null]
  endAt DateTime [not null]
  isPrivate Boolean [not null, default: false]
  teamCount Int [not null, default: 1]
  note String [not null, default: '']
  gameId String [not null]
  hostId String [not null]
  updatedAt DateTime [not null]
  createdAt DateTime [default: `now()`, not null]
}

Table RoomSettings {
  id String [pk]
  roomId String [unique, not null]
}

Table RoomMember {
  id String [pk]
  teamId String [not null]
  roomId String [not null]
  joinedAt DateTime [default: `now()`, not null]
}

Table RoomLineup {
  id String [pk]
  teamLineupId String [not null]
  roomMemberId String [not null]
  roomId String [not null]
}

Table RoomPending {
  id String [pk]
  teamId String [not null]
  roomId String [not null]
  status PendingStatus [not null, default: 'INCOMING']
}

Table Team {
  id String [pk]
  name String [not null]
  coverUrl String [not null, default: '']
  logoUrl String [not null, default: '']
  tier String [not null, default: '']
  isPrivate Boolean [not null, default: false]
  gameId String [not null]
  ownerId String
  isDeleted Boolean [not null, default: false]
  createdAt DateTime [default: `now()`, not null]
}

Table TeamSettings {
  id String [pk]
  teamId String [unique, not null]
  isJoiningEnabled Boolean [not null, default: true]
}

Table TeamMember {
  id String [pk]
  role MemberRole [not null, default: 'MEMBER']
  teamId String [not null]
  userId String [not null]
  joinedAt DateTime [default: `now()`, not null]
}

Table TeamLineup {
  id String [pk]
  teamId String [not null]
  avatarId String
  inGameId String
  isDefault Boolean [not null, default: false]
  profileUrl String [not null, default: '']
  imageUrl String [not null, default: '']
  name String [not null, default: 'new player']
  note String [not null, default: '']
}

Table TeamPending {
  id String [pk]
  teamId String [not null]
  userId String [not null]
  status PendingStatus [not null, default: 'INCOMING']
  createdAt DateTime [default: `now()`, not null]
}

Table User {
  id String [pk]
  username String [unique, not null]
  mobilePhone String [unique, not null]
  updatedUsernameAt DateTime
  password String [not null]
  displayName String [not null]
  email String [unique]
  updatedEmailAt DateTime
  bio String [not null, default: '']
  portraitUrl String [not null, default: '']
  coverUrl String [not null, default: '']
  facebookId String [unique]
  googleId String [unique]
  lineId String [unique]
  lineToken String [unique]
  firstLoginAt DateTime
  lastLoginAt DateTime
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime [not null]
}

Table UserSettings {
  id String [pk]
  userId String [unique, not null]
  isTeamNotified Boolean [not null, default: true]
  isMeNotified Boolean [not null, default: true]
  isRoomNotified Boolean [not null, default: true]
  lang Lang [not null, default: 'TH']
}

Table PasswordResetSession {
  id String [pk]
  userId String [unique, not null]
  token String [unique, not null]
  attemptCount Int [not null, default: 0]
  expiredAt DateTime [not null]
  updatedAt DateTime [not null]
  createdAt DateTime [default: `now()`, not null]
}

Table UserAvatar {
  id String [pk]
  inGameId String [not null]
  characterName String [not null, default: '']
  rank String [not null]
  ratingScore Decimal [not null, default: 0]
  gameId String [not null]
  userId String [not null]
}

Table Review {
  id String [pk]
  content String [not null]
  ratingScore Decimal [not null, default: 0]
  reviewerId String
  revieweeId String [not null]
  gameId String [not null]
  createdAt DateTime [default: `now()`, not null]
}

Table Appointment {
  id String [pk]
  startAt DateTime [not null]
  endAt DateTime [not null]
  status AppointmentStatus [not null, default: 'WAITING']
  isDeleted Boolean [not null, default: false]
  roomId String [unique]
  createdAt DateTime [default: `now()`, not null]
}

Table AppointmentMember {
  id String [pk]
  teamId String [not null]
  appointmentId String
}

Table Chat {
  id String [pk]
  roomId String [unique, not null]
}

Table Message {
  id String [pk]
  chatId String [not null]
  teamId String [not null]
  senderId String [not null]
  message String [not null]
  createdAt DateTime [default: `now()`, not null]
}

Table Matching {
  id String [pk]
  appointmentId String [unique, not null]
  hostId String
  guestId String
  hostWinCount Int [not null, default: 0]
  hostLoseCount Int [not null, default: 0]
  result MatchingResult [not null, default: 'TIE']
}

Table MatchingReport {
  id String [pk]
  matchingId String [unique, not null]
  heading String [not null]
  content String [not null]
  images String[] [not null]
  createdAt DateTime [default: `now()`, not null]
}

Table TeamStats {
  id String [pk]
  teamId String [unique, not null]
  matches Int [not null, default: 0]
  win Int [not null, default: 0]
  lose Int [not null, default: 0]
  tie Int [not null, default: 0]
  updateAt DateTime [not null]
}

Table Image {
  id String [pk]
}

Table Admin {
  id String [pk]
  email String [unique, not null]
  password String [not null]
  role AdminRole [not null, default: 'MANAGEMENT']
  createAt DateTime [default: `now()`, not null]
  updateAt DateTime [not null]
}

Enum Lang {
  TH
  EN
}

Enum RoomStatus {
  AVAILABLE
  UNAVAILABLE
  CONFIRMED
  FULL
}

Enum MemberRole {
  LEADER
  MANAGER
  MEMBER
}

Enum MatchingResult {
  WIN
  LOSE
  TIE
}

Enum PendingStatus {
  INCOMING
  OUTGOING
}

Enum AppointmentStatus {
  WAITING
  TRAINING
  DISMISSED
  DONE
}

Enum AdminRole {
  MANAGEMENT
}

Ref: Room.gameId > Game.id

Ref: Room.hostId > Team.id

Ref: RoomSettings.roomId - Room.id [delete: Cascade]

Ref: RoomMember.teamId > Team.id [delete: Cascade]

Ref: RoomMember.roomId > Room.id [delete: Cascade]

Ref: RoomLineup.teamLineupId > TeamLineup.id [delete: Cascade]

Ref: RoomLineup.roomMemberId > RoomMember.id [delete: Cascade]

Ref: RoomLineup.roomId > Room.id [delete: Cascade]

Ref: RoomPending.teamId > Team.id [delete: Cascade]

Ref: RoomPending.roomId > Room.id [delete: Cascade]

Ref: Team.gameId > Game.id

Ref: Team.ownerId > User.id [delete: Set Null]

Ref: TeamSettings.teamId - Team.id [delete: Cascade]

Ref: TeamMember.teamId > Team.id [delete: Cascade]

Ref: TeamMember.userId > User.id [delete: Cascade]

Ref: TeamLineup.teamId > Team.id [delete: Cascade]

Ref: TeamLineup.avatarId > UserAvatar.id [delete: Cascade]

Ref: TeamPending.teamId > Team.id [delete: Cascade]

Ref: TeamPending.userId > User.id [delete: Cascade]

Ref: UserSettings.userId - User.id

Ref: PasswordResetSession.userId - User.id

Ref: UserAvatar.gameId > Game.id

Ref: UserAvatar.userId > User.id [delete: Cascade]

Ref: Review.reviewerId > User.id [delete: Set Null]

Ref: Review.revieweeId > User.id [delete: Set Null]

Ref: Review.gameId > Game.id

Ref: Appointment.roomId - Room.id [delete: Set Null]

Ref: AppointmentMember.teamId > Team.id [delete: Cascade]

Ref: AppointmentMember.appointmentId > Appointment.id [delete: Cascade]

Ref: Chat.roomId - Room.id [delete: Cascade]

Ref: Message.chatId > Chat.id [delete: Cascade]

Ref: Message.teamId > Team.id [delete: Cascade]

Ref: Message.senderId > User.id [delete: Cascade]

Ref: Matching.appointmentId - Appointment.id [delete: Cascade]

Ref: Matching.hostId > Team.id [delete: Set Null]

Ref: Matching.guestId > Team.id [delete: Set Null]

Ref: MatchingReport.matchingId > Matching.id [delete: Cascade]

Ref: TeamStats.teamId - Team.id [delete: Cascade]